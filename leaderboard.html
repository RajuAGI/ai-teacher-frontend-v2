<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard â€” AI Teacher</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .lb-tabs { display:flex; gap:0; background:var(--dark2); border:1px solid var(--border); border-radius:12px; padding:4px; margin-bottom:24px; width:fit-content; }
    .lb-tab  { padding:9px 22px; border-radius:9px; cursor:pointer; font-size:14px; font-weight:700; color:var(--muted); transition:all 0.2s; }
    .lb-tab.active { background:var(--primary); color:white; }

    /* ===== AI TEACHER LEADERBOARD ===== */
    .podium { display:flex; justify-content:center; align-items:flex-end; gap:16px; margin-bottom:32px; flex-wrap:wrap; }
    .podium-item { text-align:center; }
    .podium-avatar { width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:28px; margin:0 auto 8px; border:3px solid var(--border); }
    .podium-base { border-radius:10px 10px 0 0; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; padding:12px 20px 8px; font-weight:800; color:white; }
    .rank-1 { background:linear-gradient(135deg,#f4c430,#e6a817); }
    .rank-2 { background:linear-gradient(135deg,#adb5bd,#868e96); }
    .rank-3 { background:linear-gradient(135deg,#cd7f32,#a0522d); }
    .podium-name  { font-size:14px; font-weight:700; color:var(--text); }
    .podium-score { font-size:12px; color:var(--muted); }
    .podium-rank  { font-size:22px; }

    .lb-table { width:100%; border-collapse:separate; border-spacing:0 6px; }
    .lb-table th { font-size:12px; color:var(--muted); font-weight:700; padding:6px 14px; text-align:left; text-transform:uppercase; }
    .lb-table td { padding:12px 14px; font-size:14px; }
    .lb-table tr.lb-row { background:var(--dark2); border-radius:10px; }
    .lb-table tr.lb-row:hover { background:var(--dark3); }
    .lb-table tr.lb-row td:first-child { border-radius:10px 0 0 10px; }
    .lb-table tr.lb-row td:last-child  { border-radius:0 10px 10px 0; }
    .lb-rank { font-size:16px; font-weight:800; }
    .lb-rank-1 { color:var(--gold); }
    .lb-rank-2 { color:#adb5bd; }
    .lb-rank-3 { color:#cd7f32; }
    .pct-bar { height:6px; border-radius:3px; background:var(--primary); display:inline-block; vertical-align:middle; max-width:80px; }

    /* ===== TEAMCOIN PANEL ===== */
    .tc-panel { background:var(--dark2); border:1px solid var(--border); border-radius:14px; padding:24px; }
    .tc-panel iframe { width:100%; height:600px; border:none; border-radius:10px; background:var(--dark3); }
    .tc-link-box { text-align:center; padding:40px 20px; }
    .tc-link-box .icon { font-size:54px; margin-bottom:16px; }
    .tc-link-box h3 { font-size:22px; margin-bottom:8px; }
    .tc-link-box p  { color:var(--muted); margin-bottom:20px; }
    .tc-actions { display:flex; gap:14px; justify-content:center; flex-wrap:wrap; }
    .tc-card { background:var(--dark3); border:1px solid var(--border); border-radius:12px; padding:20px; text-align:center; cursor:pointer; transition:all 0.2s; flex:1; min-width:140px; max-width:200px; }
    .tc-card:hover { border-color:var(--primary); transform:translateY(-2px); }
    .tc-card .icon { font-size:36px; margin-bottom:8px; }
    .tc-card h4 { font-size:15px; font-weight:700; }
    .tc-card p  { font-size:12px; color:var(--muted); margin-top:4px; }
  </style>
</head>
<body>
  <div id="nav-placeholder"></div>
  <main class="page-wrap">
    <div class="page-header">
      <h1>ğŸ† Leaderboard & TeamCoins</h1>
      <p>Quiz Champions aur TeamCoin Dashboard à¤à¤• à¤œà¤—à¤¹!</p>
    </div>

    <div class="lb-tabs">
      <div class="lb-tab active" id="tabQuiz" onclick="switchLbTab('quiz')">ğŸ¯ Quiz Champions</div>
      <div class="lb-tab" id="tabTC" onclick="switchLbTab('tc')">ğŸª™ TeamCoin Dashboard</div>
    </div>

    <!-- QUIZ LEADERBOARD -->
    <div id="quizLb">
      <div id="lbLoading" style="text-align:center;padding:40px;color:var(--muted)">
        <div class="spinner spinner-lg" style="margin:0 auto 16px"></div>
        Leaderboard load à¤¹à¥‹ à¤°à¤¹à¥€ à¤¹à¥ˆ...
      </div>
      <div id="lbContent" style="display:none">
        <div class="podium" id="podium"></div>
        <table class="lb-table">
          <thead>
            <tr><th>#</th><th>à¤¨à¤¾à¤®</th><th>Best Score</th><th>%</th><th>Topic</th><th>Games</th></tr>
          </thead>
          <tbody id="lbBody"></tbody>
        </table>
        <div style="font-size:13px;color:var(--muted);text-align:center;margin-top:16px" id="lbTotal"></div>
      </div>
    </div>

    <!-- TEAMCOIN PANEL -->
    <div id="tcPanel" style="display:none">
      <div class="tc-panel">
        <div class="tc-link-box">
          <div class="icon">ğŸª™</div>
          <h3>TeamCoin Dashboard</h3>
          <p>Quiz à¤–à¥‡à¤²à¤¨à¥‡ à¤ªà¤° à¤®à¤¿à¤²à¥‡ Coins à¤¯à¤¹à¤¾à¤ à¤¦à¤¿à¤–à¤¤à¥‡ à¤¹à¥ˆà¤‚à¥¤ Team à¤¬à¤¨à¤¾à¤“, Coins transfer à¤•à¤°à¥‹!</p>
          <div class="tc-actions">
            <div class="tc-card" onclick="window.open('https://rajuagi.github.io/teamcoin-frontend/dashboard.html','_blank')">
              <div class="icon">ğŸ’°</div>
              <h4>My Dashboard</h4>
              <p>Balance, History</p>
            </div>
            <div class="tc-card" onclick="window.open('https://rajuagi.github.io/teamcoin-frontend/team.html','_blank')">
              <div class="icon">ğŸ‘¥</div>
              <h4>My Team</h4>
              <p>Team join/create</p>
            </div>
            <div class="tc-card" onclick="window.open('https://rajuagi.github.io/teamcoin-frontend/transfer.html','_blank')">
              <div class="icon">â†—ï¸</div>
              <h4>Transfer</h4>
              <p>Coins bhejo</p>
            </div>
            <div class="tc-card" onclick="window.open('https://rajuagi.github.io/teamcoin-frontend/leaderboard.html','_blank')">
              <div class="icon">ğŸ…</div>
              <h4>TC Leaderboard</h4>
              <p>Top holders</p>
            </div>
          </div>
          <br>
          <a href="https://rajuagi.github.io/teamcoin-frontend" target="_blank" class="btn btn-gold btn-lg">
            ğŸª™ TeamCoin Website à¤–à¥‹à¤²à¥‹ â†—
          </a>
        </div>
      </div>
    </div>
  </main>
  <div id="footer-placeholder"></div>
  <script src="nav.js"></script>
  <script>
    function switchLbTab(tab) {
      document.getElementById("quizLb").style.display  = tab==="quiz" ? "block" : "none";
      document.getElementById("tcPanel").style.display = tab==="tc"   ? "block" : "none";
      document.getElementById("tabQuiz").className = "lb-tab" + (tab==="quiz" ? " active" : "");
      document.getElementById("tabTC").className   = "lb-tab" + (tab==="tc"   ? " active" : "");
    }

    async function loadLeaderboard() {
      try {
        const data = await api("/leaderboard");
        document.getElementById("lbLoading").style.display = "none";
        document.getElementById("lbContent").style.display = "block";

        const lb = data.leaderboard || [];
        if (!lb.length) {
          document.getElementById("lbContent").innerHTML = '<div style="text-align:center;color:var(--muted);padding:40px">à¤…à¤­à¥€ à¤•à¥‹à¤ˆ score à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ Quiz à¤–à¥‡à¤²à¥‹! ğŸ¯</div>';
          return;
        }

        // Podium (top 3)
        const podium = document.getElementById("podium");
        const order  = [1,0,2]; // 2nd, 1st, 3rd
        const heights= [80, 110, 60];
        const rcls   = ["rank-2","rank-1","rank-3"];
        const medals = ["ğŸ¥ˆ","ğŸ¥‡","ğŸ¥‰"];
        order.forEach((i, pos) => {
          if (!lb[i]) return;
          const item = lb[i];
          const div  = document.createElement("div");
          div.className = "podium-item";
          div.innerHTML = `
            <div class="podium-avatar" style="border-color:${pos===1?'var(--gold)':pos===0?'#adb5bd':'#cd7f32'}">${getInitialEmoji(item.name)}</div>
            <div class="podium-name">${item.name}</div>
            <div class="podium-score">${item.best_score}/${item.best_total||15} (${item.percentage}%)</div>
            <div class="podium-base ${rcls[pos]}" style="height:${heights[pos]}px;width:90px;margin-top:8px">
              <div class="podium-rank">${medals[pos]}</div>
              <div style="font-size:12px">Rank ${i+1}</div>
            </div>`;
          podium.appendChild(div);
        });

        // Table
        const tbody = document.getElementById("lbBody");
        lb.forEach((item, i) => {
          const tr = document.createElement("tr");
          tr.className = "lb-row";
          const rankCls = i===0?"lb-rank-1":i===1?"lb-rank-2":i===2?"lb-rank-3":"";
          tr.innerHTML = `
            <td><span class="lb-rank ${rankCls}">${i<3?["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][i]:i+1}</span></td>
            <td style="font-weight:700">${getInitialEmoji(item.name)} ${item.name}</td>
            <td><strong style="color:var(--primary)">${item.best_score}</strong>/${item.best_total||15}</td>
            <td>
              <span style="color:var(--gold);font-weight:700;margin-right:6px">${item.percentage}%</span>
              <span class="pct-bar" style="width:${item.percentage*0.8}px"></span>
            </td>
            <td style="color:var(--muted);font-size:12px">${item.best_topic||"-"}</td>
            <td style="color:var(--muted)">${item.games_played||1}</td>`;
          tbody.appendChild(tr);
        });

        document.getElementById("lbTotal").innerText = `ğŸ¯ à¤•à¥à¤² ${data.total_players||lb.length} à¤–à¤¿à¤²à¤¾à¤¡à¤¼à¤¿à¤¯à¥‹à¤‚ à¤¨à¥‡ Quiz à¤–à¥‡à¤²à¥€`;
      } catch (e) {
        document.getElementById("lbLoading").innerHTML = `<div style="color:var(--muted)">âŒ Leaderboard load à¤¨à¤¹à¥€à¤‚ à¤¹à¥à¤ˆà¥¤ <button class="btn btn-sm btn-primary" onclick="loadLeaderboard()" style="margin-left:10px">Retry</button></div>`;
      }
    }

    function getInitialEmoji(name) {
      const emojis = ["ğŸ§‘","ğŸ‘©","ğŸ‘¨","ğŸ§‘â€ğŸ“","ğŸ‘©â€ğŸ“","ğŸ‘¨â€ğŸ“","ğŸŒŸ","ğŸ†","ğŸ’ª","ğŸš€","ğŸŒˆ","ğŸ¦"];
      const idx = (name?.charCodeAt(0)||0) % emojis.length;
      return emojis[idx];
    }

    document.addEventListener("DOMContentLoaded", loadLeaderboard);
  </script>
</body>
</html>
