<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login â€” AI Teacher</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { display:flex; flex-direction:column; min-height:100vh; align-items:center; justify-content:center; background: linear-gradient(135deg, #0d1117 0%, #1a1a2e 50%, #16213e 100%); }
    .auth-box { background:var(--dark2); border:1px solid var(--border); border-radius:20px; padding:36px; width:100%; max-width:420px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); margin:20px; }
    .auth-logo { text-align:center; margin-bottom:28px; }
    .auth-logo h1 { font-size:28px; color:var(--primary); }
    .auth-logo p  { font-size:13px; color:var(--muted); margin-top:4px; }
    .tabs { display:flex; gap:0; margin-bottom:24px; background:var(--dark3); border-radius:10px; padding:4px; }
    .tab { flex:1; padding:9px; text-align:center; border-radius:8px; cursor:pointer; font-weight:700; font-size:14px; color:var(--muted); transition:all 0.2s; }
    .tab.active { background:var(--primary); color:white; }
    .avatar-picker { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
    .avatar-opt { font-size:28px; cursor:pointer; padding:6px; border-radius:8px; border:2px solid transparent; transition:all 0.2s; }
    .avatar-opt:hover { border-color:var(--primary); background:var(--dark3); }
    .avatar-opt.selected { border-color:var(--gold); background:var(--dark3); }
    .forgot { font-size:12px; color:var(--muted); text-align:right; margin-top:4px; cursor:pointer; }
    .forgot:hover { color:var(--primary); }
    .divider { text-align:center; color:var(--muted); font-size:12px; margin:16px 0; position:relative; }
    .divider::before,.divider::after { content:''; position:absolute; top:50%; width:42%; height:1px; background:var(--border); }
    .divider::before { left:0; } .divider::after { right:0; }
  </style>
</head>
<body>
  <div class="auth-box">
    <div class="auth-logo">
      <h1>ğŸ§‘â€ğŸ« AI Teacher</h1>
      <p>à¤—à¤°à¥€à¤¬ à¤¬à¤šà¥à¤šà¥‹à¤‚ à¤•à¥‹ à¤®à¥à¤«à¥à¤¤ à¤¶à¤¿à¤•à¥à¤·à¤¾ â€” à¤°à¤¾à¤œà¥‚ à¤°à¤¾à¤® ğŸ‡®ğŸ‡³</p>
    </div>

    <div class="tabs">
      <div class="tab active" id="tabLogin" onclick="switchTab('login')">ğŸ” Login</div>
      <div class="tab" id="tabRegister" onclick="switchTab('register')">ğŸ“ Register</div>
    </div>

    <div id="alertBox" class="alert"></div>

    <!-- LOGIN FORM -->
    <div id="loginForm">
      <div class="input-group">
        <label class="input-label">ğŸ“§ Email</label>
        <input class="input" type="email" id="loginEmail" placeholder="apna@email.com" />
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ”’ Password</label>
        <input class="input" type="password" id="loginPwd" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
        <div class="forgot" onclick="alert('Admin se contact karo: contact.html')">Password bhool gaye?</div>
      </div>
      <button class="btn btn-primary btn-full btn-lg" onclick="doLogin()" id="loginBtn">
        Login à¤•à¤°à¥‹ â†’
      </button>
      <div class="divider">ya</div>
      <p style="text-align:center;font-size:13px;color:var(--muted)">New user? <span style="color:var(--primary);cursor:pointer;font-weight:700" onclick="switchTab('register')">Register karo!</span></p>
    </div>

    <!-- REGISTER FORM -->
    <div id="registerForm" style="display:none">
      <div class="input-group">
        <label class="input-label">ğŸ™‚ Avatar à¤šà¥à¤¨à¥‹</label>
        <div class="avatar-picker" id="avatarPicker">
          <span class="avatar-opt selected" data-v="ğŸ‘¤" onclick="selectAvatar(this)">ğŸ‘¤</span>
          <span class="avatar-opt" data-v="ğŸ§‘â€ğŸ“" onclick="selectAvatar(this)">ğŸ§‘â€ğŸ“</span>
          <span class="avatar-opt" data-v="ğŸ‘©â€ğŸ“" onclick="selectAvatar(this)">ğŸ‘©â€ğŸ“</span>
          <span class="avatar-opt" data-v="ğŸ§‘â€ğŸ«" onclick="selectAvatar(this)">ğŸ§‘â€ğŸ«</span>
          <span class="avatar-opt" data-v="ğŸ§‘â€ğŸ’»" onclick="selectAvatar(this)">ğŸ§‘â€ğŸ’»</span>
          <span class="avatar-opt" data-v="ğŸ¦¸" onclick="selectAvatar(this)">ğŸ¦¸</span>
          <span class="avatar-opt" data-v="ğŸŒŸ" onclick="selectAvatar(this)">ğŸŒŸ</span>
          <span class="avatar-opt" data-v="ğŸ¯" onclick="selectAvatar(this)">ğŸ¯</span>
        </div>
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ‘¤ à¤ªà¥‚à¤°à¤¾ à¤¨à¤¾à¤®</label>
        <input class="input" type="text" id="regName" placeholder="Raju Ram" />
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ“§ Email</label>
        <input class="input" type="email" id="regEmail" placeholder="apna@email.com" />
      </div>
      <div class="input-group">
        <label class="input-label">ğŸ”’ Password (à¤•à¤® à¤¸à¥‡ à¤•à¤® 6 characters)</label>
        <input class="input" type="password" id="regPwd" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      </div>
      <button class="btn btn-green btn-full btn-lg" onclick="doRegister()" id="regBtn">
        Account à¤¬à¤¨à¤¾à¤“ ğŸ‰
      </button>
    </div>
  </div>

  <script src="nav.js"></script>
  <script>
    let selectedAvatar = "ğŸ‘¤";

    function switchTab(tab) {
      document.getElementById("loginForm").style.display    = tab==="login"    ? "block" : "none";
      document.getElementById("registerForm").style.display = tab==="register" ? "block" : "none";
      document.getElementById("tabLogin").className    = "tab" + (tab==="login"    ? " active" : "");
      document.getElementById("tabRegister").className = "tab" + (tab==="register" ? " active" : "");
      document.getElementById("alertBox").style.display = "none";
    }

    function selectAvatar(el) {
      document.querySelectorAll(".avatar-opt").forEach(e => e.classList.remove("selected"));
      el.classList.add("selected");
      selectedAvatar = el.dataset.v;
    }

    async function doLogin() {
      const email = document.getElementById("loginEmail").value.trim();
      const pwd   = document.getElementById("loginPwd").value;
      if (!email || !pwd) { showAlert("alertBox","à¤¸à¤­à¥€ fields à¤­à¤°à¥‡à¤‚","error"); return; }
      setLoading("loginBtn", true, "Login à¤¹à¥‹ à¤°à¤¹à¤¾ à¤¹à¥ˆ...");
      try {
        const data = await api("/login","POST",{email, password:pwd});
        if (data.error) { showAlert("alertBox", data.error, "error"); return; }
        localStorage.setItem("at_token",  data.token);
        localStorage.setItem("at_name",   data.name);
        localStorage.setItem("at_avatar", data.avatar||"ğŸ‘¤");
        showAlert("alertBox", data.message || `à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ ${data.name}! ğŸ‰`, "success", 1500);
        setTimeout(() => { window.location.href = "index.html"; }, 1200);
      } catch { showAlert("alertBox","Backend à¤¸à¥‡ connect à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤ªà¤¾à¤¯à¤¾à¥¤ Retry à¤•à¤°à¥‹à¥¤","error"); }
      finally { setLoading("loginBtn", false, "Login à¤•à¤°à¥‹ â†’"); }
    }

    async function doRegister() {
      const name  = document.getElementById("regName").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const pwd   = document.getElementById("regPwd").value;
      if (!name||!email||!pwd) { showAlert("alertBox","à¤¸à¤­à¥€ fields à¤­à¤°à¥‡à¤‚","error"); return; }
      setLoading("regBtn", true, "Account à¤¬à¤¨ à¤°à¤¹à¤¾ à¤¹à¥ˆ...");
      try {
        const data = await api("/register","POST",{name, email, password:pwd, avatar:selectedAvatar});
        if (data.error) { showAlert("alertBox", data.error, "error"); return; }
        localStorage.setItem("at_token",  data.token);
        localStorage.setItem("at_name",   data.name);
        localStorage.setItem("at_avatar", selectedAvatar);
        showAlert("alertBox", data.message || "Account à¤¬à¤¨ à¤—à¤¯à¤¾! ğŸ‰", "success", 1500);
        setTimeout(() => { window.location.href = "index.html"; }, 1200);
      } catch { showAlert("alertBox","Backend à¤¸à¥‡ connect à¤¨à¤¹à¥€à¤‚ à¤¹à¥‹ à¤ªà¤¾à¤¯à¤¾à¥¤","error"); }
      finally { setLoading("regBtn", false, "Account à¤¬à¤¨à¤¾à¤“ ğŸ‰"); }
    }

    function setLoading(id, on, label) {
      const el = document.getElementById(id);
      el.disabled    = on;
      el.innerHTML   = on ? `<div class="spinner" style="width:18px;height:18px;border-width:2px"></div> ${label}` : label;
    }

    // Enter key
    document.addEventListener("DOMContentLoaded", () => {
      ["loginEmail","loginPwd"].forEach(id => {
        document.getElementById(id).addEventListener("keypress", e => { if(e.key==="Enter") doLogin(); });
      });
      if (isLoggedIn()) window.location.href = "index.html";
    });
  </script>
</body>
</html>
